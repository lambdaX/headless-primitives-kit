<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeadlessButton ESM Example</title>
    <style>
        body { font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .button-container { padding: 20px; border: 1px solid #ccc; border-radius: 8px; min-width: 300px; text-align: center; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid transparent;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s, opacity 0.2s;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; color: #666; cursor: not-allowed; opacity: 0.7; }
        button.pressed { background-color: #004085; }
        button.error { border-color: red; background-color: #ffdddd; color: red;}
        .controls { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; align-items: flex-start; border: 1px solid #eee; padding: 15px; border-radius: 5px;}
        .controls label { display: flex; align-items: center; gap: 5px;}
        .state-display { margin-top: 15px; padding: 10px; background-color: #f0f0f0; border-radius: 5px; font-family: monospace; white-space: pre-wrap; text-align: left; }
    </style>
</head>
<body>

    <h1>HeadlessButton Browser ESM Example</h1>
    <p>
        <!--
        IMPORTANT NOTE FOR THIS EXAMPLE TO WORK:
        The 'headless-primitives-kit' GitHub repository (lambdaX/headless-primitives-kit)
        MUST have the compiled 'dist' directory (containing headless-button.js, headless-component.js, etc.)
        committed and pushed to the 'main' branch.
        If the 'dist' directory is not in the repository, the CDN links below will result in 404 errors.
        You typically generate the 'dist' folder by running 'npm run build:logic' or 'npm run build'
        and then commit this folder to your repository.
        -->
    </p>

    <div id="root" class="button-container">Button will load here...</div>

    <script type="module">
        // Import React and ReactDOM from a CDN
        const React = await import('https://esm.sh/react@18.3.1');
        const ReactDOM = await import('https://esm.sh/react-dom@18.3.1/client');

        // Import HeadlessButton and its dependencies from your package via jsDelivr
        // These URLs assume the 'dist' folder exists at the root of your 'main' branch.
        const { HeadlessButton } = await import('https://cdn.jsdelivr.net/gh/lambdaX/headless-primitives-kit@main/dist/headless-button.js');
        // HeadlessButton depends on HeadlessComponent, CommandInvoker, EventEmitter, etc.
        // The browser will fetch these as needed if they are imported within headless-button.js
        // For this explicit example, let's assume we might need direct access or to show structure:
        const { HeadlessComponent } = await import('https://cdn.jsdelivr.net/gh/lambdaX/headless-primitives-kit@main/dist/headless-component.js');
        const { CommandInvoker } = await import('https://cdn.jsdelivr.net/gh/lambdaX/headless-primitives-kit@main/dist/command.js');
        const { EventEmitter } = await import('https://cdn.jsdelivr.net/gh/lambdaX/headless-primitives-kit@main/dist/event-emitter.js');
        // Ensure other necessary classes like ComponentState, IdleState, etc. are also available if directly referenced or needed by HeadlessComponent subclasses.
        // For simplicity, this example primarily focuses on HeadlessButton.

        function App() {
            const [buttonText, setButtonText] = React.useState('Click Me');
            const buttonRef = React.useRef(null);

            // Instantiate HeadlessButton
            const headlessButton = React.useMemo(() => new HeadlessButton(), []);

            const [componentState, setComponentState] = React.useState(headlessButton.getState());
            const [cssState, setCssState] = React.useState(headlessButton.getCSSState());
            const [historyState, setHistoryState] = React.useState(headlessButton.getHistory());

            React.useEffect(() => {
                const onStateChange = () => {
                    setComponentState(headlessButton.getState());
                    setCssState(headlessButton.getCSSState());
                };
                const onHistoryChange = () => {
                    setHistoryState(headlessButton.getHistory());
                }

                headlessButton.subscribe('stateChanged', onStateChange);
                headlessButton.subscribe('stateTransition', onStateChange); // CSS state changes on transition
                headlessButton.subscribe('historyChanged', onHistoryChange);

                // Initial sync
                onStateChange();
                onHistoryChange();

                headlessButton.subscribe('clicked', () => {
                    console.log('Headless button was clicked!');
                    setButtonText(prev => prev === 'Click Me' ? 'Clicked!' : 'Click Me');
                    setTimeout(() => setButtonText('Click Me'), 1000);
                });

                return () => {
                    headlessButton.unsubscribe('stateChanged', onStateChange);
                    headlessButton.unsubscribe('stateTransition', onStateChange);
                    headlessButton.unsubscribe('historyChanged', onHistoryChange);
                };
            }, [headlessButton]);


            const handleToggleDisabled = (e) => {
                headlessButton.setDisabled(e.target.checked);
            };
            const handleToggleLoading = (e) => {
                headlessButton.setLoading(e.target.checked);
            };
            const handleToggleError = (e) => {
                headlessButton.setError(e.target.checked ? 'Sample Error!' : null);
            };

            return (
                React.createElement('div', null,
                    React.createElement('button', {
                        ref: buttonRef,
                        type: 'button',
                        onClick: (e) => headlessButton.click(e),
                        onMouseEnter: (e) => headlessButton.hover(true, e),
                        onMouseLeave: (e) => headlessButton.hover(false, e),
                        onFocus: (e) => headlessButton.focus(true, e),
                        onBlur: (e) => headlessButton.focus(false, e),
                        onKeyDown: (e) => headlessButton.keydown(e),
                        onMouseDown: () => headlessButton.press(true),
                        onMouseUp: () => headlessButton.press(false),
                        disabled: componentState.isDisabled || componentState.isLoading,
                        className: \`\${cssState.classes.join(' ')} \${componentState.isPressed ? 'pressed' : ''} \${componentState.error ? 'error' : ''}\`,
                        ...cssState.dataAttributes,
                        'aria-disabled': componentState.isDisabled || componentState.isLoading,
                    }, componentState.isLoading ? 'Loading...' : (componentState.error ? 'Error!' : buttonText)),
                    React.createElement('div', { className: 'controls' },
                        React.createElement('h3', null, 'Controls:'),
                        React.createElement('label', null,
                            React.createElement('input', { type: 'checkbox', checked: !!componentState.isDisabled, onChange: handleToggleDisabled }),
                            'Disabled'
                        ),
                        React.createElement('label', null,
                            React.createElement('input', { type: 'checkbox', checked: !!componentState.isLoading, onChange: handleToggleLoading }),
                            'Loading'
                        ),
                        React.createElement('label', null,
                            React.createElement('input', { type: 'checkbox', checked: !!componentState.error, onChange: handleToggleError }),
                            'Error'
                        ),
                        React.createElement('div', { style: { display: 'flex', gap: '10px', marginTop: '10px'}},
                            React.createElement('button', { onClick: () => headlessButton.undo(), disabled: !historyState.canUndo }, 'Undo'),
                            React.createElement('button', { onClick: () => headlessButton.redo(), disabled: !historyState.canRedo }, 'Redo')
                        )
                    ),
                    React.createElement('div', { className: 'state-display' },
                        React.createElement('h4', null, 'HeadlessButton State:'),
                        JSON.stringify({ dataState: componentState, cssState, history: historyState }, null, 2)
                    )
                )
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(App));
    </script>

</body>
</html>
