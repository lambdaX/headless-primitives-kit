
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeadlessButton ESM Example</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        button {
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }
        button:hover { background-color: #e0e0e0; }
        button:active { transform: translateY(1px); }
        button[data-disabled="true"] { opacity: 0.5; cursor: not-allowed; }
        button[data-loading="true"] { opacity: 0.7; cursor: wait; }
        button[data-error="true"] { border-color: red; background-color: #ffe0e0; }
        .pressed { background-color: #c0c0c0 !important; }
        .focused { box-shadow: 0 0 0 2px blue; }
        .hovered { background-color: #d0d0d0; }
        #state-output { margin-top: 20px; padding: 10px; border: 1px solid #eee; background-color: #f9f9f9; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
        .note { font-size: 0.9em; color: #555; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>HeadlessButton ESM Example</h1>
        <p>This example demonstrates how to use the <code>HeadlessButton</code> directly via ES Modules from a CDN.</p>
        
        <div id="button-root">Button loading...</div>
        <pre id="state-output">Button state will appear here.</pre>

        <div class="note">
            Troubleshooting:
            <ul>
                <li>Ensure the "Build and Deploy Headless Logic" GitHub Action has successfully run and committed the <code>dist</code> folder (with correct structure) to the <code>master</code> branch.</li>
                <li>Ensure the "Deploy to GitHub Pages" GitHub Action has successfully run.</li>
                <li>Check your browser's developer console (F12) for any errors. A 404 error for a <code>.js</code> file means it's not found on the CDN.</li>
                <li>A "SyntaxError: Unexpected token '&lt;'" usually means a script URL returned HTML (e.g., a 404 page) instead of JavaScript. Verify CDN links and that the files exist at those paths.</li>
            </ul>
        </div>
    </div>

    <script type="module">
        // Import React and ReactDOM from a reliable ESM CDN
        const React = await import('https://esm.sh/react@18.3.1');
        const ReactDOM = await import('https://esm.sh/react-dom@18.3.1/client');
        const { useEffect } = React; // Destructure useEffect after React is loaded

        // Import HeadlessButton and useHeadlessComponent from jsDelivr
        // These point to your GitHub repository's 'dist' folder on the 'master' branch.
        const { HeadlessButton } = await import('https://cdn.jsdelivr.net/gh/lambdaX/headless-primitives-kit@master/dist/components/headless-logic/headless-button.js');
        const { useHeadlessComponent } = await import('https://cdn.jsdelivr.net/gh/lambdaX/headless-primitives-kit@master/dist/hooks/use-headless-component.js');

        function MyStyledButton() {
            const { component, componentState, cssState } = useHeadlessComponent(HeadlessButton);

            useEffect(() => {
                const handleButtonClick = (event, data) => {
                    console.log('Button clicked!', data);
                    updateStateOutput();
                };
                const handleStateChange = () => updateStateOutput();

                component.subscribe('clicked', handleButtonClick);
                component.subscribe('stateChanged', handleStateChange);
                component.subscribe('cssStateChanged', handleStateChange);
                
                updateStateOutput(); // Initial state

                return () => {
                    component.unsubscribe('clicked', handleButtonClick);
                    component.unsubscribe('stateChanged', handleStateChange);
                    component.unsubscribe('cssStateChanged', handleStateChange);
                };
            }, [component]); // Added component to dependency array for useEffect

            function updateStateOutput() {
                const outputElement = document.getElementById('state-output');
                if (outputElement) {
                    outputElement.textContent = JSON.stringify({
                        dataState: component.getState(),
                        cssState: component.getCSSState()
                    }, null, 2);
                }
            }
            
            let buttonClasses = "my-button";
            if (componentState.isPressed) buttonClasses += " pressed";
            if (componentState.isFocused) buttonClasses += " focused";
            if (componentState.isHovered && !componentState.isPressed) buttonClasses += " hovered";

            return React.createElement('button', {
                type: 'button',
                onClick: (e) => component.click(e),
                onMouseEnter: (e) => component.hover(true, e),
                onMouseLeave: (e) => component.hover(false, e),
                onFocus: (e) => component.focus(true, e),
                onBlur: (e) => component.focus(false, e),
                onKeyDown: (e) => component.keydown(e),
                onMouseDown: () => component.press(true),
                onMouseUp: () => component.press(false),
                disabled: componentState.isDisabled || componentState.isLoading,
                'data-disabled': String(componentState.isDisabled),
                'data-loading': String(componentState.isLoading),
                'data-error': String(!!componentState.error),
                className: buttonClasses + " " + cssState.classes.join(' '), // Combine local and headless classes
                ...cssState.dataAttributes
            }, componentState.isLoading ? 'Loading...' : componentState.error ? 'Error!' : 'Click Me (ESM)');
        }
        
        try {
            const rootElement = document.getElementById('button-root');
            if (rootElement) {
                const root = ReactDOM.createRoot(rootElement);
                root.render(React.createElement(MyStyledButton));
            } else {
                console.error("Button root element not found.");
            }
        } catch (error) {
            console.error("Error rendering React component:", error);
            const rootElement = document.getElementById('button-root');
            if (rootElement) {
                rootElement.innerHTML = '<p style="color: red;">Error rendering component. Check console.</p>';
            }
        }
    </script>
</body>
</html>
