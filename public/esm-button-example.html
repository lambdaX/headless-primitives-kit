
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeadlessButton ESM Example</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin-top: 50px; background-color: #f0f0f0; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            background-color: #fff;
            transition: background-color 0.2s, box-shadow 0.2s;
            min-width: 150px;
        }
        button:hover:not([disabled]) {
            background-color: #e9e9e9;
        }
        button:focus:not([disabled]) {
            outline: none;
            box-shadow: 0 0 0 2px skyblue;
        }
        button[data-pressed="true"]:not([disabled]) {
            background-color: #d0d0d0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        button[disabled], button[data-disabled="true"] {
            background-color: #f5f5f5;
            color: #aaa;
            cursor: not-allowed;
            opacity: 0.7;
        }
        button[data-loading="true"] {
            background-color: #e0e0ff;
            cursor: wait;
        }
        .controls { margin-top: 20px; display: flex; gap: 10px; }
        .state-display { margin-top: 20px; padding: 10px; background-color: #fff; border: 1px solid #ddd; border-radius: 5px; font-family: monospace; white-space: pre; }
    </style>
</head>
<body>
    <h1>HeadlessButton ESM Example</h1>
    <p>This example demonstrates using the <code>HeadlessButton</code> directly in the browser via ES module imports from a CDN.</p>
    <p>Note: Replace <code>'headless-primitives-kit'</code> with your actual published package name on unpkg.com or your preferred CDN.</p>

    <div id="root"></div>
    <div class="state-display" id="state-info">Loading component and state...</div>

    <script type="module">
        // Step 1: Import React and ReactDOM
        import React, { useState, useEffect, useMemo, useCallback } from 'https://esm.sh/react@18.3.1';
        import ReactDOM from 'https://esm.sh/react-dom@18.3.1/client';

        // Step 2: Import HeadlessButton and its dependencies
        // Replace 'headless-primitives-kit' with your actual package name if different
        // These imports assume your package exports modules from the 'dist' folder as configured.
        // Unpkg will resolve these based on the 'exports' field in your package.json.
        // For example, 'headless-primitives-kit/headless-button' should point to 'dist/headless-button.js'.

        // NOTE: The browser will make separate requests for each imported module and its dependencies.
        // e.g., headless-button.js will import headless-component.js, etc.
        // This is standard ESM behavior.

        // It's crucial that your published package correctly exposes these modules.
        // The paths here must match the subpath exports defined in your package.json's "exports" field.
        const pkgName = 'headless-primitives-kit'; // Configure this to your actual package name

        // For simplicity, we are importing directly from the 'dist' path as unpkg would serve them.
        // If your "exports" map in package.json correctly maps "your-pkg/headless-button" to "./dist/headless-button.js",
        // then `https://unpkg.com/your-pkg/headless-button` would work.
        // However, to be explicit about what unpkg serves based on the tsc output to `dist`,
        // we can point to the dist files more directly if subpath exports aren't perfectly set up or understood by unpkg for deep paths.
        // For a robust setup, ensure `exports` in package.json handles subpath exports correctly.

        // Let's assume the "exports" in package.json are set up like:
        // "exports": {
        //   "./headless-button": "./dist/headless-button.js",
        //   ... other components
        //   "./headless-component": "./dist/headless-component.js",
        //   etc.
        // }
        // Then unpkg should resolve these paths correctly.

        // Main component logic
        const HeadlessButtonModule = await import(\`https://unpkg.com/\${pkgName}/headless-button\`);
        const { HeadlessButton } = HeadlessButtonModule;

        // The useHeadlessComponent hook is specific to your Next.js app's /hooks directory.
        // For a pure browser ESM example, we'll manually manage state and subscriptions.

        function MyEsmButton() {
            const buttonLogic = useMemo(() => new HeadlessButton(), []);
            const [componentState, setComponentState] = useState(buttonLogic.getState());
            const [cssState, setCssState] = useState(buttonLogic.getCSSState());
            const [historyState, setHistoryState] = useState(buttonLogic.getHistory());

            useEffect(() => {
                const stateDisplay = document.getElementById('state-info');
                const updateDisplay = () => {
                    if (stateDisplay) {
                        stateDisplay.textContent = JSON.stringify({
                            dataState: buttonLogic.getState(),
                            cssState: buttonLogic.getCSSState(),
                            history: buttonLogic.getHistory()
                        }, null, 2);
                    }
                };

                const onStateChanged = () => {
                    setComponentState(buttonLogic.getState());
                    updateDisplay();
                };
                const onCssStateChanged = () => {
                    setCssState(buttonLogic.getCSSState());
                    updateDisplay();
                };
                const onHistoryChanged = () => {
                    setHistoryState(buttonLogic.getHistory());
                    updateDisplay();
                }

                const unsubState = buttonLogic.subscribe('stateChanged', onStateChanged);
                const unsubCss = buttonLogic.subscribe('cssStateChanged', onCssStateChanged);
                const unsubTransition = buttonLogic.subscribe('stateTransition', () => {
                    setComponentState(buttonLogic.getState());
                    setCssState(buttonLogic.getCSSState());
                    updateDisplay();
                });
                const unsubHistory = buttonLogic.subscribe('historyChanged', onHistoryChanged);

                updateDisplay(); // Initial display

                return () => {
                    unsubState();
                    unsubCss();
                    unsubTransition();
                    unsubHistory();
                };
            }, [buttonLogic]);

            const handleUndo = useCallback(() => buttonLogic.undo(), [buttonLogic]);
            const handleRedo = useCallback(() => buttonLogic.redo(), [buttonLogic]);

            return React.createElement('div', { style: { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '15px' } },
                React.createElement('button', {
                    type: 'button',
                    onClick: (e) => buttonLogic.click(e),
                    onMouseEnter: (e) => buttonLogic.hover(true, e),
                    onMouseLeave: (e) => buttonLogic.hover(false, e),
                    onFocus: (e) => buttonLogic.focus(true, e),
                    onBlur: (e) => buttonLogic.focus(false, e),
                    onKeyDown: (e) => buttonLogic.keydown(e),
                    onMouseDown: () => buttonLogic.press(true),
                    onMouseUp: () => buttonLogic.press(false),
                    disabled: componentState.isDisabled || componentState.isLoading,
                    'aria-disabled': componentState.isDisabled || componentState.isLoading,
                    className: cssState.classes.join(' '), // You'd need CSS definitions for these headless classes
                    ...cssState.dataAttributes // Applies data-disabled, data-loading etc.
                }, componentState.isLoading ? 'Loading...' : (componentState.error ? 'Error!' : 'Headless Button')),
                React.createElement('div', { className: 'controls' },
                    React.createElement('button', { onClick: () => buttonLogic.setDisabled(!componentState.isDisabled) }, componentState.isDisabled ? 'Enable' : 'Disable'),
                    React.createElement('button', { onClick: () => buttonLogic.setLoading(!componentState.isLoading) }, componentState.isLoading ? 'Stop Loading' : 'Load'),
                    React.createElement('button', { onClick: () => buttonLogic.setError(componentState.error ? null : 'Sample Error') }, componentState.error ? 'Clear Error' : 'Set Error')
                ),
                React.createElement('div', { className: 'controls' },
                    React.createElement('button', { onClick: handleUndo, disabled: !historyState.canUndo }, 'Undo'),
                    React.createElement('button', { onClick: handleRedo, disabled: !historyState.canRedo }, 'Redo')
                )
            );
        }

        // Step 4: Render the React component
        const container = document.getElementById('root');
        if (container) {
            const root = ReactDOM.createRoot(container);
            root.render(React.createElement(MyEsmButton));
        } else {
            console.error('Root element not found');
        }
    </script>
</body>
</html>

    